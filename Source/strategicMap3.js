<html>
	<head>
		<script src="http://ppmlatam183.ca.com/niku/app?action=dms.viewFile&RhXm0r7tSeUqEr=true&fileId=5074420&fileName=wsdl_wrapper.js"/>
		<script language="javascript">
		function getCSSStyle( status) {
			var cssStyle = 'stratItem';
			
			switch(status) {
				case '1':
					cssStyle = "stratItemBlack";
					break;
				case '2':
					cssStyle = "stratItemRed";
					break;
				case '3':
					cssStyle = "stratItemYellow";
					break;
				case '4':
					cssStyle = "stratItemGreen";
					break;
				case '5':
					cssStyle = "stratItemGreen";
					break;
				case '6':
					cssStyle = "stratItemBlue";
					break;
				default:
					cssStyle = "stratItemWhite";
			}
			return cssStyle;
		}		
		function eventFire(el, etype){
			if (el.fireEvent) {
				el.fireEvent('on' + etype);
			} else {
				var evObj = document.createEvent('Events');
				evObj.initEvent(etype, true, false);
				el.dispatchEvent(evObj);
			}
		}

		</script>
	</head>
	<body>
		<div style="position:absolute; top:10px; right:10px">
			<a href="JavaScript:print()">
				<img id="print" src="data:image/png;base64,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" alt="Print" width="20" height="20" align="right">
			</a>
		</div>
		<div id="parentdiv">				
			<canvas id="myCanvas" width="1000" height="660" style="border:0px solid #d3d3d3;">
				Your browser does not support the HTML5 canvas tag.
			</canvas>
		</div>			

		
		<script language="javascript">

			/* 	debugMode=1 -> Init
				debugMode=2 -> SoapClient
				debugMode=3 -> L1 Query Result 
				debugMode=4 -> L2 Query Result
				debugMode=5 -> L3 Query Result 
				debugMode=6 -> DD Query Result */
			
			var debugMode=0;
			
			/* Fetching ServerName and Item ID */
			var vModal=0;
			var url = window.document.URL;
			
			var vDialogs = document.getElementsByClassName("ppm_dialog");
			if (vDialogs.length > 0) vModal=1;
			
			if (vModal==1) {
				/* Popup */
				var innerUrl = document.getElementById('ppm_mnp').innerHTML; /* This is the Div that contains the Modal page */
				idLocation = innerUrl.indexOf('instance_id')+12;
				var end = idLocation + 7;
				var internalID = innerUrl.substring(idLocation,end);
			}
			else
			{
				/* Not a Popup */
				var idLocation = url.indexOf('id=')+3;
				var end = idLocation + 7;
				var internalID = url.substring(idLocation, end);
			}
			var ServerName = url.substring(7,url.indexOf("niku/")-1);
			if(debugMode==1) console.log("URL: "+url);
			
			/* Query Setup */
			var Item = internalID;
			if(debugMode==1) console.log("CurrentItem: "+Item)

			var QueryFilterField = "currentid";
			var QueryFilterValue = Item;
			var QueryCallback="";
				
			/* Execute Query for Level 1
				use this statement to test running the query as admin (remember to set the password accordingly)
				var Result=ExecuteClarityQueryAsAdmin(debugMode, ServerName, QueryCode, QueryFilterField, QueryFilterValue, "admin", "iluvca", QueryCallback);
			*/
				
			var QueryCode="strat_map_wsdl";
			if(debugMode==3) console.log("Query L1 Parameters --Server Name: "+ServerName+"--Query Code: "+QueryCode+"--Filter Field: "+QueryFilterField+"--Filter Value: "+QueryFilterValue+"--Call Back: "+QueryCallback);

			var Result=ExecuteClarityQueryAsUser(debugMode, ServerName, QueryCode, QueryFilterField, QueryFilterValue, QueryCallback);
			
			if(debugMode==3) console.log("Back from Query L1:"+Result.responseText);

			/* Parse Query Results */
			var xmlobject = crossBrowserXMLLoad(Result.responseText);
			var items = xmlobject.getElementsByTagName("Record");
			var item = items[0];
			var intlid 		 	  	= item.getElementsByTagName("intlid")[0].firstChild.nodeValue;
			var itemcode  	 	  	= item.getElementsByTagName("itemcode")[0].firstChild.nodeValue;
			var itemname	 	  	= item.getElementsByTagName("itemname")[0].firstChild.nodeValue;
			var itemstatus	 	  	= item.getElementsByTagName("itemstatus")[0].firstChild.nodeValue;
			var itempercent  	  	= item.getElementsByTagName("itempercent")[0].firstChild.nodeValue;
			var itemurlmap 		  	= item.getElementsByTagName("mapurl")[0].firstChild.nodeValue;
			var itemxmap 		  	= item.getElementsByTagName("itemxmap")[0].firstChild.nodeValue;
			var itemymap	 	  	= item.getElementsByTagName("itemymap")[0].firstChild.nodeValue;

			if(debugMode==3) console.log("Query L1 itemcode="+itemcode+" intlid="+intlid+" itemname="+itemname+" itemstatus="+itemstatus+" itempercent="+itempercent+" itemurlmap="+itemurlmap+" itemxmap="+itemxmap+" itemymap="+itemymap);
			
			/* Draw Image */
			var c=document.getElementById("myCanvas");
			var ctx=c.getContext("2d");
			var img = new Image(); 
			img.src = itemurlmap;
			if(debugMode==1) console.log("Image SRC:"+img.src);
			img.onload = function() {
				/* Parse Query Results AGAIN */
				xmlobject = crossBrowserXMLLoad(Result.responseText);
				items = xmlobject.getElementsByTagName("Record");
				item = items[0];
				intlid 		 	  	= item.getElementsByTagName("intlid")[0].firstChild.nodeValue;
				itemcode  	 	  	= item.getElementsByTagName("itemcode")[0].firstChild.nodeValue;
				itemname	 	  	= item.getElementsByTagName("itemname")[0].firstChild.nodeValue;
				itemstatus	 	  	= item.getElementsByTagName("itemstatus")[0].firstChild.nodeValue;
				itempercent  	  	= item.getElementsByTagName("itempercent")[0].firstChild.nodeValue;
				itemurlmap 		  	= item.getElementsByTagName("mapurl")[0].firstChild.nodeValue;
				itemxmap 		  	= item.getElementsByTagName("itemxmap")[0].firstChild.nodeValue;
				itemymap	 	  	= item.getElementsByTagName("itemymap")[0].firstChild.nodeValue;

				ctx.drawImage(img, 10, 10);
				
				if(debugMode==3) console.log("L1 Will draw circle");
				if(debugMode==3) console.log("Circle L1 is itemcode="+itemcode+" intlid="+intlid+" itemname="+itemname+" itemstatus="+itemstatus+" itempercent="+itempercent+" itemurlmap="+itemurlmap+" itemxmap="+itemxmap+" itemymap="+itemymap);
				
				var cssColor = getCSSStyle(itemstatus);
				console.log(cssColor);

				var childdiv = document.createElement('div');
				childdiv.className = 'stratItem ' + getCSSStyle(itemstatus)  ;
				childdiv.style.position = 'absolute';
				childdiv.id = intlid;
				childdiv.style.top = (itemymap).toString() + "px";
				childdiv.style.left = (itemxmap).toString() + "px";
				childdiv.innerHTML='<div>' + itempercent + '%</div>';
				childdiv.onclick = function(){ 
					/* DrillDown URL */
					var jumpLink = '/niku/nu#action:strategic_item_dashboard&id='+this.id;
					if (vModal==1){
						/* Modal Panel = Jump to Link and Close Modal Panel */
						window.open(jumpLink,"_self","",false);
						eventFire(document.getElementsByClassName('ppm_dialog_close')[0], 'click');
					}
					else {
						/* NOT Modal Panel = Jump to Link */
						window.location.assign(jumpLink);	
					}
				
				}

				parentdiv.appendChild(childdiv);
				
				console.log('Item Status:' , itemstatus);


				if(debugMode==3) console.log("L1 has drawn circle");

				/* Execute Query for Level 2
					use this statement to test running the query as admin (remember to set the password accordingly)
					var Result=ExecuteClarityQueryAsAdmin(debugMode, ServerName, QueryCode, QueryFilterField, QueryFilterValue, "admin", "iluvca", QueryCallback);
				*/
				QueryCode="strat_map_wsdl2";
				if(debugMode==4) console.log("Query L2 Parameters --Server Name: "+ServerName+"--Query Code: "+QueryCode+"--Filter Field: "+QueryFilterField+"--Filter Value: "+QueryFilterValue+"--Call Back: "+QueryCallback);

				Result=ExecuteClarityQueryAsUser(debugMode, ServerName, QueryCode, QueryFilterField, QueryFilterValue, QueryCallback);
				
				if(debugMode==4) console.log("Back from QueryL2:"+Result.responseText);

				/* Parse Query Results */
				xmlobject = crossBrowserXMLLoad(Result.responseText);
				items = xmlobject.getElementsByTagName("Record");
				var totalitems = items.length;
				if(debugMode==4) console.log("Total Items L2="+totalitems);
				
				/* Draw L2 Status */
				for (var i = 0 ; i < totalitems ; i++) {
					var item = items[i];
					var intlid 		 	  	= item.getElementsByTagName("intlid")[0].firstChild.nodeValue;
					var itemcode  	 	  	= item.getElementsByTagName("itemcode")[0].firstChild.nodeValue;
					var itemname	 	  	= item.getElementsByTagName("itemname")[0].firstChild.nodeValue;
					var itemstatus	 	  	= item.getElementsByTagName("itemstatus")[0].firstChild.nodeValue;
					var itempercent  	  	= item.getElementsByTagName("itempercent")[0].firstChild.nodeValue;
					var itemxmap 		  	= item.getElementsByTagName("itemxmap")[0].firstChild.nodeValue;
					var itemymap	 	  	= item.getElementsByTagName("itemymap")[0].firstChild.nodeValue;

					if(debugMode==4) console.log("Query L2 itemcode="+itemcode+" intlid="+intlid+" itemname="+itemname+" itemstatus="+itemstatus+" itempercent="+itempercent+" itemxmap="+itemxmap+" itemymap="+itemymap);

					if(debugMode==4) console.log("L2 Will draw circle");
					
					var cssColor = getCSSStyle(itemstatus);
					console.log(cssColor);

					var childdiv = document.createElement('div');
					childdiv.className = 'stratItem ' + getCSSStyle(itemstatus)  ;
					childdiv.style.position = 'absolute';
					childdiv.id = intlid;
					childdiv.style.top = (itemymap).toString() + "px";
					childdiv.style.left = (itemxmap).toString() + "px";
					childdiv.innerHTML='<div>' + itempercent + '%</div>';
					childdiv.onclick = function(){ 
						/* DrillDown URL */
						var jumpLink = '/niku/nu#action:strategic_item_dashboard&id='+this.id;
						if (vModal==1){
							/* Modal Panel = Jump to Link and Close Modal Panel */
							window.open(jumpLink,"_self","",false);
							eventFire(document.getElementsByClassName('ppm_dialog_close')[0], 'click');
						}
						else {
							/* NOT Modal Panel = Jump to Link */
							window.location.assign(jumpLink);	
						}
					
					}

					parentdiv.appendChild(childdiv);
					
					console.log('Item Status:' , itemstatus);


					if(debugMode==4) console.log("L2 has drawn circle");
				}
				
				
				/* Execute Query for Level 3
					use this statement to test running the query as admin (remember to set the password accordingly)
					var Result=ExecuteClarityQueryAsAdmin(debugMode, ServerName, QueryCode, QueryFilterField, QueryFilterValue, "admin", "iluvca", QueryCallback);
				*/
				QueryCode="strat_map_wsdl3";
				if(debugMode==5) console.log("Query L3 Parameters --Server Name: "+ServerName+"--Query Code: "+QueryCode+"--Filter Field: "+QueryFilterField+"--Filter Value: "+QueryFilterValue+"--Call Back: "+QueryCallback);

				Result=ExecuteClarityQueryAsUser(debugMode, ServerName, QueryCode, QueryFilterField, QueryFilterValue, QueryCallback);
				
				if(debugMode==5) console.log("Back from QueryL3:"+Result.responseText);

				/* Parse Query Results */
				xmlobject = crossBrowserXMLLoad(Result.responseText);
				items = xmlobject.getElementsByTagName("Record");
				var totalitems = items.length;
				if(debugMode==5) console.log("Total Items L3="+totalitems);
				
				/* Draw L3 Status */
				for (var i = 0 ; i < totalitems ; i++) {
					var item = items[i];
					var intlid 		 	  	= item.getElementsByTagName("intlid")[0].firstChild.nodeValue;
					var itemcode  	 	  	= item.getElementsByTagName("itemcode")[0].firstChild.nodeValue;
					var itemname	 	  	= item.getElementsByTagName("itemname")[0].firstChild.nodeValue;
					var itemstatus	 	  	= item.getElementsByTagName("itemstatus")[0].firstChild.nodeValue;
					var itempercent  	  	= item.getElementsByTagName("itempercent")[0].firstChild.nodeValue;
					var itemxmap 		  	= item.getElementsByTagName("itemxmap")[0].firstChild.nodeValue;
					var itemymap	 	  	= item.getElementsByTagName("itemymap")[0].firstChild.nodeValue;

					if(debugMode==5) console.log("Query L3 itemcode="+itemcode+" intlid="+intlid+" itemname="+itemname+" itemstatus="+itemstatus+" itempercent="+itempercent+" itemxmap="+itemxmap+" itemymap="+itemymap);

					if(debugMode==5) console.log("L3 Will draw circle");
					
					var cssColor = getCSSStyle(itemstatus);
					console.log(cssColor);

					var childdiv = document.createElement('div');
					childdiv.className = 'stratItem ' + getCSSStyle(itemstatus)  ;
					childdiv.style.position = 'absolute';
					childdiv.id = intlid;
					childdiv.style.top = (itemymap).toString() + "px";
					childdiv.style.left = (itemxmap).toString() + "px";
					childdiv.innerHTML='<div>' + itempercent + '%</div>';
					childdiv.onclick = function(){ 
						/* DrillDown URL */
						var jumpLink = '/niku/nu#action:strategic_item_dashboard&id='+this.id;
						if (vModal==1){
							/* Modal Panel = Jump to Link and Close Modal Panel */
							window.open(jumpLink,"_self","",false);
							eventFire(document.getElementsByClassName('ppm_dialog_close')[0], 'click');
						}
						else {
							/* NOT Modal Panel = Jump to Link */
							window.location.assign(jumpLink);	
						}
					
					}

					parentdiv.appendChild(childdiv);
					
					console.log('Item Status:' , itemstatus);

					if(debugMode==5) console.log("L3 has drawn circle");
				}
			}
		</script>
	</body>
</html>